// Prisma schema for Project Library
// Defines the database models and their relationships

generator client {
	provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// User model for authentication and profiles (Milestone A & B)
model User {
	id             String    @id @default(cuid())
	email          String    @unique
	passwordHash   String    // bcrypt hashed password
	username       String    @unique
	name           String?
	headline       String?
	bio            String?
	interests      String[]  @default([]) // array of interest tags, optional
	location       String?
	createdAt      DateTime  @default(now())
	updatedAt      DateTime  @updatedAt

	projects       Project[] // projects owned by this user
	events         Event[]   // events created by this user
	sentMessages   Message[] @relation("SentMessages") // messages sent by this user
	receivedMessages Message[] @relation("ReceivedMessages") // messages received by this user

	@@map("users")
}

// Project model for user-created projects (Milestone C)
// Enhanced with image support (Milestone E)
model Project {
	id             String    @id @default(cuid())
	type           String    @default("project") // discriminator field for collection types
	title          String    // required project title
	description    String    // required project description
	tags           String[]  @default([]) // array of project tags, optional
	imageUrl       String?   // optional image URL/path for project image
	ownerId        String    // foreign key to User
	createdAt      DateTime  @default(now())
	updatedAt      DateTime  @updatedAt

	owner          User      @relation(fields: [ownerId], references: [id], onDelete: Cascade)
	entries        ProjectEntry[] // entries/updates for this project

	@@map("projects")
}

// Event model for Milestone F (new post type with location data)
model Event {
	id          String    @id @default(cuid())
	type        String    @default("event") // discriminator field for collection types
	title       String    // required event title
	description String    // required event description
	dateTime    DateTime  // when the event occurs
	location    String    // address or location name
	latitude    Float?    // optional coordinates for map display
	longitude   Float?    // optional coordinates for map display
	tags        String[]  @default([]) // event tags/categories
	imageUrls   String[]  @default([]) // optional images for the event
	ownerId     String
	createdAt   DateTime  @default(now())
	updatedAt   DateTime  @updatedAt

	owner       User      @relation(fields: [ownerId], references: [id], onDelete: Cascade)

	@@map("events")
}

// Message model for direct messaging between users
model Message {
	id          String    @id @default(cuid())
	content     String    // message text content
	senderId    String    // foreign key to User (sender)
	receiverId  String    // foreign key to User (receiver)
	createdAt   DateTime  @default(now())
	readAt      DateTime? // timestamp when message was read (optional, for future read receipts)

	sender      User      @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
	receiver    User      @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)

	@@map("messages")
}

// Entry model extends Collection type
model Entry {
	id          String    @id @default(cuid())
	resourceType 
	resourceId  String   // foreign key to Resource
	title       String?   // optional entry title (e.g., "Update #1", "Progress Update")
	content     String    // entry text content
	createdAt   DateTime  @default(now())
	updatedAt   DateTime  @updatedAt
	project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

	@@map("entries")
}

model Collection {
	id
	resourceType

}

model Image {
	id
	imageUrl


}